---
title: 客户端水化
desc: Quasar服务器端渲染应用程序中的水化是什么及其注意事项。
---
水化指的是客户端的过程，在这个过程中，Vue接管了服务器发送的静态HTML，并将其转化为动态DOM，可以对客户端的数据变化做出反应。

由于服务器已经渲染了标记，我们显然不想扔掉它并重新创建所有的DOM元素。相反，我们想把静态标记 "水化"，使其成为互动的。

::: warning
在开发模式下，Vue会断定客户端生成的虚拟DOM树与从服务器渲染的DOM结构相匹配。如果有不匹配，它将放弃水化，丢弃现有的DOM并从头开始渲染。**在生产模式下，这个断言被禁用，以获得最大的性能**。
:::

## 水合的注意事项
在使用SSR+客户端水合时，需要注意的一点是一些特殊的HTML结构可能会被浏览器改变。例如，当你在Vue模板中这样写时。

```html
<table>
  <tr><td>hi</td></tr>
</table>
```

浏览器会自动将`<tbody>`注入`<table>`内，然而，Vue生成的虚拟DOM不包含`<tbody>`，所以会造成不匹配。为了确保正确的匹配，确保在你的模板中编写有效的HTML。

## 处理水合错误

如果你确实收到了水合错误(如在控制台看到的。"Vuejs Error - The client-side rendered virtual DOM tree is not matching server-rendered content")，你可以尝试以下步骤。
1. 在Chrome浏览器中显示DevTools (F12)
2. 加载导致 "客户端渲染的虚拟DOM树... "警告的页面。
3. 3. 滚动到DevTools控制台中的警告。
4. 4.点击vue.runtime.esm.js中警告的源位置超链接。
5. 在那里设置一个断点(在源代码浏览器中左键点击行号)。
6. 6.让同样的警告再次出现。通常是通过重新加载页面。如果有很多警告，你可以通过将鼠标移到`msg`变量上检查信息。
7. 7. 当你找到你的信息并停在断点上时，看一下_调用堆栈_。点击向下一帧调用 "patch "来打开它的来源。将鼠标悬停在补丁中执行行上方4行的hydrate函数调用。通往Hydrate源代码的超链接将被打开。
8. 在hydrate函数中，从开始的15行开始，在`assertNodeMatch'返回`false'后返回false的地方设置一个断点。在那里设置断点，并删除所有其他断点。
9. 9. 让同样的警告再次发生。现在，当断点被击中时， hydrate函数的执行应该停止。切换到DevTools控制台，评估`elm`，然后是`vnode`。这里`elm`似乎是一个_server-rendered DOM element_，而`vnode`是一个_virtual DOM node_。`Elm`被打印成HTML，所以你可以找出错误发生的地方。
